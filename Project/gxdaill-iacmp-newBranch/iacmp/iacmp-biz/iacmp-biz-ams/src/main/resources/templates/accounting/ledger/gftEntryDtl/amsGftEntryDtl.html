<!DOCTYPE html>
<html lang="zh" xmlns:th="http://www.thymeleaf.org" xmlns:shiro="http://www.pollix.at/thymeleaf/shiro">
<style>
    .select-list label {
        /*width: 110px;*/
    }

    label.error {
        right: auto !important;
        top: auto;
        left: 140px;
    }

    .form-horizontal {
        margin-top: 10px;
    }

    .form-horizontal label {
        width: 121px;
        padding-top: 7px;
        margin-bottom: 0px;
        text-align: left !important;
        padding-right: 0;
        font-weight: normal;
        font-size: 13px;
        color: #333;
    }

    .form-control, .single-line {
        font-size: 13px !important;
        height: 26px !important;
        overflow: hidden !important;
        padding-top: 1px !important;
        padding-bottom: 1px !important;

    }

    .form-group {
        margin-bottom: 10px !important;

    }

    .select-list .form-control {
        border: 1px solid #ddd;
        border-radius: 4px;
        background: transparent;
        outline: none;
        height: 30px;
        width: 200px;
        padding-left: 5px;
        display: inline-block;
    }

    #form-gftEntryDtl-search .list-item input {
        border: 1px solid #ddd;
        border-radius: 4px;
        background: transparent;
        outline: none;
        height: 30px;
        width: 200px;
        padding-left: 5px;

    }

    .select-list .form-horizontal {
        display: flex;
        flex-wrap: wrap;
        align-content: space-between;
    }

    .list-item {
        margin-bottom: 10px !important;
        width: max-content;

    }

    .list-item > div {
        width: 350px;
    }

    .list-item select {
        border: 1px solid #ddd;
        border-radius: 4px;
        background: transparent;
        outline: none;
        height: 30px;
        width: 200px;
    }
</style>
<head>
    <!--<link th:href="@{/css/bootstrap.min.css}" rel="stylesheet" type="text/css"/>-->
    <th:block th:include="include :: header('列表')"/>
    <th:block th:include="include :: header('栅格')"/>
    <th:block th:include="include :: daterangepicker-css"/>
</head>
<body class="gray-bg">
<div class="container-div">
    <div class="row">
        <div class="col-sm-12 search-collapse">
            <form id="form-gftEntryDtl-search">
                <div class="select-list">
                    <div class="form-horizontal lists">
                        <div class="list-item">
                            <div class="  ">
                                <label for="voucherCate" class="control-label text-left">凭证类别:</label>
                                <select name="voucherCate" class="" id="voucherCate">
                                    <option value="">请选择</option>
                                    <option value="001">总账凭证</option>
                                    <option value="002">核心凭证</option>
                                    <option value="003">消费信贷凭证</option>
                                    <option value="004">结转凭证</option>
                                    <option value="005">总账凭证-金融工具</option>
                                    <option value="006">总账凭证-资产减值</option>
                                    <option value="007">总账凭证-所得税</option>
                                    <option value="008">总账凭证-中间业务收入</option>
                                    <option value="009">总账凭证-增值税</option>
                                    <option value="010">财务凭证</option>
                                    <option value="011">黄金凭证</option>
                                    <option value="099">单边凭证</option>
                                </select>
                                <!--<input id="voucherCate"  class=" "  type="text" name="voucherCate">-->
                            </div>
                        </div>
                        <div class="list-item">
                            <div class="  ">
                                <label for="voucherId" class="control-label text-left">凭证号:</label>
                                <input id="voucherId" class=" " type="text" name="voucherId">
                            </div>
                        </div>
                        <div class="list-item">
                            <div class="  ">
                                <label for="dealNum" class=" control-label text-left">交易流水号:</label>
                                <input id="dealNum" class=" " type="text" name="dealNum">
                            </div>
                        </div>
                        <!--<div class="list-item">-->
                        <!--<div class="  " id="defaultrange">-->
                        <!--<label for="tallyDt" class=" control-label">记账日期(30天):</label>-->
                        <!--<input id="tallyDt"  class=" "  type="text" name="tallyDt" required>-->
                        <!--</div>-->
                        <!--<div id="defaultrangeHide" style="display: none;">-->
                        <!--<input type="text" id="tallyDtStart" placeholder="" name="tallyDtStart" />-->
                        <!--<input type="text" id="tallyDtEnd" placeholder="" name="tallyDtEnd" />-->
                        <!--</div>-->
                        <!--</div>-->
                        <div class="list-item">
                            <div class="select-time">
                                <label style="margin-top:0;">记账日期(30天)： </label>
                                <input type="text" style="width: 93px;margin-left:3px;height: 30px;"
                                       class="input-sm form-control" id="tallyDtStart" placeholder=""
                                       name="tallyDtStart">
                                <span>-</span>
                                <input type="text" style="width: 93px;height: 30px;" class="input-sm form-control"
                                       id="tallyDtEnd" placeholder="" name="tallyDtEnd">
                            </div>
                        </div>


                        <div class="list-item">
                            <div class="  ">
                                <label for="asstSrcSys" class="  control-label">辅助核算项来源系统:</label>
                                <input id="asstSrcSys" class=" " type="text" name="asstSrcSys">
                            </div>
                        </div>
                        <div class="list-item">
                            <div class="  ">
                                <label for="subjId" class="  control-label">会计科目:</label>
                                <!--<select name="subjId" class="" id="subjId">
                                    <option value="">请选择</option>
                                    <option th:each="acc : ${bdAccasoaList}" th:text="${acc.name}"
                                            th:value="${acc.dispname}"></option>
                                </select>-->
                                <input type="text" class=" " id="subjId" name="subjId"
                                       onclick="selectSubjId('subjId');subjId.blur();return false;"
                                       placeholder="请选择会计科目" readonly/>

                                <!--<input id="subjId"  class=" "  type="text" name="subjId">-->
                            </div>
                        </div>
                    </div>


                    <!--<li>-->
                    <!--<label>开始时间：</label>-->
                    <!--<input type="text" id="tallyDtStart" placeholder="" name="tallyDtStart"/>-->
                    <!--</li>-->

                    <!--<li>-->
                    <!--<label>结束时间：</label>-->
                    <!--<input type="text" id="tallyDtEnd" placeholder="" name="tallyDtEnd"/>-->
                    <!--</li>-->


                    <!--<li>-->
                    <!--<label>记账日期开始(全部)：</label>-->
                    <!--<input type="text" id="tallyDtStart1" placeholder="" name="tallyDtStart"/>-->
                    <!--</li>-->

                    <!--<li>-->
                    <!--<label>记账日期结束(全部)：</label>-->
                    <!--<input type="text" id="tallyDtEnd1" placeholder="" name="tallyDtEnd"/>-->
                    <!--</li>-->

                    <!--<li>
                        <div class="select-time">
                            <label>历史数据查询： </label>
                            <input type="text" style="width: 200px;margin-left: 2px" class="input-sm  " id="tallyDtStart1" placeholder="" name="tallyDtStart"/>
                                <span style="margin-left: 58px;margin-right: 58px">到</span>
                            <input type="text" style="width: 200px;" class="input-sm  " id="tallyDtEnd1" placeholder="" name="tallyDtEnd"/>
                        </div>
                    </li>-->


                    <!--<li style="">-->
                    <!--<div class="select-time">-->
                    <!--<label style="margin-right: 5px;">记账日期开始: </label>-->
                    <!--<input type="text" class="input-sm  " id="tallyDtStart" placeholder="" name="tallyDtStart"/>-->
                    <!--<span>-</span>-->
                    <!--<input type="text" style=";width: 151px;" class="input-sm  " id="tallyDtEnd" placeholder="" name="tallyDtEnd"/>-->
                    <!--</div>-->
                    <!--</li>-->

                    <!--<li>-->
                    <!--记账日期：<input type="text" name="tallyDt"/>-->
                    <!--</li>-->
                    <li style="margin-right: 600px">
                        <a class="btn btn-primary btn-rounded btn-sm" id="search_btn"><i class="fa fa-search"></i>&nbsp;搜索</a>
                        <a class="btn btn-warning btn-rounded btn-sm" onclick="$.form.reset()"><i
                                class="fa fa-refresh"></i>&nbsp;重置</a>
                        <a class="btn btn-success btn-rounded btn-sm" onclick="openClose()"><i id="openCloseI"
                                                                                               class="fa fa-download"></i>&nbsp;<span
                                id="openCloseSpan">展开</span></a>
                    </li>
                    <div class="clearfix"></div>
                    <div id="openClose" class="form-horizontal" style="display:none;">
                        <div class="list-item">
                            <div class="  ">
                                <label for="bookId" class="  control-label">账簿编号:</label>
                                <!--<input id="bookId"  class=" "  type="text" name="bookId">-->
                                <input type="text" class=" " id="bookId" name="bookId"
                                       onclick="selectBook('bookId');bookId.blur();return false;" placeholder="请选择账簿"
                                       readonly/>
                                <!--<select name="bookId" class="" id="bookId">
                                    <option value="">请选择</option>
                                    <option th:each="book : ${bookList}" th:text="${book.name}"
                                            th:value="${book.code}"></option>
                                </select>-->
                            </div>
                        </div>
                        <div class="list-item">
                            <div class="  ">
                                <label for="dealAcct" class="  control-label">交易账户:</label>
                                <input id="dealAcct" class=" " type="text" name="dealAcct">
                            </div>
                        </div>
                        <div class="list-item">
                            <div class="  ">
                                <label for="auditor" class="  control-label">审核人:</label>
                                <!--<select name="auditor" class="" id="auditor">
                                    <option value="">请选择</option>
                                    <option th:each="user : ${smUserList}" th:text="${user.userName}"
                                            th:value="${user.userCode}"></option>
                                </select>-->
                                <input type="text" class=" " id="auditor" name="auditor"
                                       onclick="selectUser('auditor');auditor.blur();return false;" placeholder="请选择审核人"
                                       readonly/>
                                <!--        <input id="auditor"  class="form-control"  type="text" name="auditor">-->
                            </div>
                        </div>
                        <div class="list-item">
                            <div class="  ">
                                <label for="preparer" class="  control-label">制单人:</label>
                                <!--<select name="preparer" class="" id="preparer">
                                    <option value="">请选择</option>
                                    <option th:each="user : ${smUserList}" th:text="${user.userName}"
                                            th:value="${user.userCode}"></option>
                                </select>-->
                                <input type="text" class=" " id="preparer" name="preparer"
                                       onclick="selectUser('preparer');preparer.blur();return false;"
                                       placeholder="请选择制单人" readonly/>
                                <!--  <input id="preparer"  class="form-control"  type="text" name="preparer">-->
                            </div>
                        </div>
                        <div class="list-item">
                            <div class="  ">
                                <label for="bookkeeper" class="  control-label">记账人:</label>
                                <!--<select name="bookkeeper" class="" id="bookkeeper">
                                    <option value="">请选择</option>
                                    <option th:each="user : ${smUserList}" th:text="${user.userName}"
                                            th:value="${user.userCode}"></option>
                                </select>-->
                                <input type="text" class=" " id="bookkeeper" name="bookkeeper"
                                       onclick="selectUser('bookkeeper');bookkeeper.blur();return false;"
                                       placeholder="请选择记账人" readonly/>
                                <!-- <input id="bookkeeper"  class="form-control"  type="text" name="bookkeeper">-->
                            </div>
                        </div>
                        <div class="list-item">
                            <div class="  ">
                                <label for="acctsYear" class="  control-label">会计年度:</label>
                                <input id="acctsYear" class=" " type="text" name="acctsYear">
                            </div>
                        </div>
                        <div class="list-item">
                            <div class="  ">
                                <!--<label for="acctsMonth" class="  control-label">会计月份:</label>-->
                                <!--<input id="acctsMonth"  class=" "  type="text">-->
                                <!--<input id="acctsMonthHidden"  class=" "  type="text" name="acctsMonth" hidden>-->
                                <label for="acctsMonth" class="">会计月份:</label>
                                <select name="acctsMonth" class="" id="acctsMonth">
                                    <option value="">请选择</option>
                                    <option value="01">1月</option>
                                    <option value="02">2月</option>
                                    <option value="03">3月</option>
                                    <option value="04">4月</option>
                                    <option value="05">5月</option>
                                    <option value="06">6月</option>
                                    <option value="07">7月</option>
                                    <option value="08">8月</option>
                                    <option value="09">9月</option>
                                    <option value="10">10月</option>
                                    <option value="11">11月</option>
                                    <option value="12">12月</option>
                                </select>
                            </div>
                        </div>
                        <div class="list-item">
                            <div class="  ">
                                <label for="adjPeriod" class="  control-label">调整期间:</label>
                                <select name="adjPeriod" class="" id="adjPeriod">
                                    <option value="">请选择</option>
                                    <option value="01">1月</option>
                                    <option value="02">2月</option>
                                    <option value="03">3月</option>
                                    <option value="04">4月</option>
                                    <option value="05">5月</option>
                                    <option value="06">6月</option>
                                    <option value="07">7月</option>
                                    <option value="08">8月</option>
                                    <option value="09">9月</option>
                                    <option value="10">10月</option>
                                    <option value="11">11月</option>
                                    <option value="12">12月</option>
                                </select>
                                <!--<input id="adjPeriod"  class=" "  type="text" name="adjPeriod">-->
                            </div>
                        </div>
                        <div class="list-item">
                            <div class="  ">
                                <label for="auditDt" class="  control-label">审核日期:</label>
                                <input id="auditDt" class=" " type="text" name="auditDt">
                            </div>
                        </div>
                        <div class="list-item">
                            <div class="  ">
                                <label for="prepareDt" class="  control-label">制单日期:</label>
                                <input id="prepareDt" class=" " type="text" name="prepareDt">
                            </div>
                        </div>
                        <div class="list-item">
                            <div class="  ">
                                <label for="addBillNum" class="  control-label">附属单据:</label>
                                <input id="addBillNum" class=" " type="text" name="addBillNum">
                            </div>
                        </div>
                        <div class="list-item">
                            <div class="  ">
                                <label for="prepareSys" class="  control-label">制单系统:</label>
                                <input id="prepareSys" class="" type="text" name="prepareSys">
                            </div>
                        </div>
                        <div class="list-item">
                            <div class="  ">
                                <label for="entryId" class="  control-label">分录号:</label>
                                <input id="entryId" class=" " type="text" name="entryId">
                            </div>
                        </div>
                        <div class="list-item">
                            <div class="  ">
                                <label for="entryCont" class="  control-label">分录摘要:</label>
                                <input id="entryCont" class=" " type="text" name="entryCont">
                            </div>
                        </div>
                        <div class="list-item">
                            <div class="  ">
                                <label for="asstOrg" class="  control-label">辅助核算项部门:</label>
                                <!--<select name="asstOrg" class="" id="asstOrg">
                                    <option value="">请选择</option>
                                    <option th:each="org : ${orgOrgsList}" th:text="${org.name}"
                                            th:value="${org.code}"></option>
                                </select>-->
                                <input type="text" class=" " id="asstOrg" name="asstOrg"
                                       onclick="selectOrg('asstOrg');asstOrg.blur();return false;" placeholder="请选择部门"
                                       readonly/>
                                <!--<input id="asstOrg"  class=" "  type="text" name="asstOrg">-->
                            </div>
                        </div>
                        <div class="list-item">
                            <div class="  ">
                                <!--<label for="asstOrg" class="  control-label">币种编号:</label>-->
                                <!--<input id="ccyId"  class=" "  type="text" name="ccyId">-->
                                <label for="ccyId">币种编号:</label>
                                <select style="" id="ccyId" name="ccyId" th:with="type=${@dict.getType('ccyId')}">
                                    <option value="" selected="selected">全部</option>
                                    <option th:each="dict : ${type}" th:text="${dict.dictLabel}"
                                            th:value="${dict.dictValue}"></option>
                                </select>
                            </div>
                        </div>
                        <div class="list-item">
                            <div class="  ">
                                <label for="exRate" class="  control-label">汇率:</label>
                                <input id="exRate" class=" " type="text" name="exRate">
                            </div>
                        </div>
                        <div class="list-item">
                            <!--<div class="  ">-->
                            <!--<label for="amtDir" class="  control-label">发生额方向:</label>-->
                            <!--<input id="amtDir"  class=" "  type="text" name="amtDir">-->
                            <!--</div>-->
                            <label for="amtDir">发生额方向:</label>
                            <select style="" id="amtDir" name="amtDir" th:with="type=${@dict.getType('amtDir')}">
                                <option value="" selected="selected">全部</option>
                                <option th:each="dict : ${type}" th:text="${dict.dictLabel}"
                                        th:value="${dict.dictValue}"></option>
                            </select>
                        </div>
                        <div class="list-item">
                            <div class="  ">
                                <label for="oriDebAmt" class="  control-label">原币借方发生额:</label>
                                <input id="oriDebAmt" class=" " type="text" name="oriDebAmt">
                            </div>
                        </div>
                        <div class="list-item">
                            <div class="  ">
                                <label for="locDebAmt" class="  control-label">本币借方发生额:</label>
                                <input id="locDebAmt" class=" " type="text" name="locDebAmt">
                            </div>
                        </div>
                        <div class="list-item">
                            <div class="  ">
                                <label for="isEyearTurn" class="">是否年末结转:</label>
                                <select id="isEyearTurn" name="isEyearTurn"
                                        th:with="type=${@dict.getType('isEyearTurn')}">
                                    <option selected="selected" value="">请选择</option>
                                    <option th:each="dict : ${type}" th:text="${dict.dictLabel}"
                                            th:value="${dict.dictValue}"></option>
                                </select>

                            </div>
                        </div>
                        <div class="list-item">
                            <div class="  ">
                                <label for="isOff" class="">是否表外:</label>
                                <select id="isOff" name="isOff" th:with="type=${@dict.getType('isOff')}">
                                    <option selected="selected" value="">请选择</option>
                                    <option th:each="dict : ${type}" th:text="${dict.dictLabel}"
                                            th:value="${dict.dictValue}"></option>
                                </select>

                            </div>
                        </div>
                    </div>
                </div>
            </form>
        </div>

        <div class="btn-group-sm" id="toolbar" role="group">
            <!--<a class="btn btn-success" onclick="$.operate.add()" shiro:hasPermission="iacmp:gftEntryDtl:add">-->
            <!--<i class="fa fa-plus"></i> 添加-->
            <!--</a>-->
            <!--<a class="btn btn-primary single disabled" onclick="$.operate.edit()" shiro:hasPermission="iacmp:gftEntryDtl:edit">-->
            <!--<i class="fa fa-edit"></i> 修改-->
            <!--</a>-->
            <!--<a class="btn btn-danger multiple disabled" onclick="$.operate.removeAll()" shiro:hasPermission="iacmp:gftEntryDtl:remove">-->
            <!--<i class="fa fa-remove"></i> 删除-->
            <!--</a>-->
            <a class="btn btn-warning" onclick="$.table.exportExcel()" shiro:hasPermission="iacmp:gftEntryDtl:export">
                <i class="glyphicon glyphicon-export"></i> 导出
            </a>
        </div>
        <div class="col-sm-12 select-table table-striped">
            <table id="bootstrap-table" data-mobile-responsive="true"></table>
        </div>
    </div>
</div>
<div th:include="include :: footer"></div>
<!--<th:block th:include="include :: footer" />-->
<th:block th:include="include :: daterangepicker-js"/>

<script th:inline="javascript">
    var editFlag = [[${@permission.hasPermi('iacmp:gftEntryDtl:edit')}]];
    //var removeFlag = [[${@permission.hasPermi('iacmp:gftEntryDtl:remove')}]];
    var detailFlag = [[${@permission.hasPermi('accounting:ledger:gftEntryDtl:detail')}]];
    var isEyearTurn = [[${@dict.getType('isEyearTurn')}]];
    var isOff = [[${@dict.getType('isOff')}]];

    var prefix = ctx + "accounting/ledger/gftEntryDtl";
    var amtDir = [[${@dict.getType('amtDir')}]];
    var ccyId = [[${@dict.getType('ccyId')}]];


    //var icon = "<i class='fa fa-times-circle'></i> ";
    $("#form-gftEntryDtl-search").validate();

    // 多次提交只提交一次
    $('#search_btn').on('click', debounce(submitHandler, 10000, true));

    /**
     * @desc 函数防抖
     * @param func 函数
     * @param wait 延迟执行毫秒数
     * @param immediate true 表立即执行，false 表非立即执行
     */
    function debounce(func, wait, immediate) {
        var timeout;
        return function () {
            var context = this;
            var args = arguments;
            if (timeout) {
                clearTimeout(timeout)
            }
            ;
            if (immediate) {
                var callNow = !timeout;
                timeout = setTimeout(function () {
                    timeout = null;
                }, wait)
                if (callNow) {
                    func.apply(context, args)
                }
            } else {
                timeout = setTimeout(function () {
                    func.apply(context, args)
                }, wait);
            }
        }
    }

    function submitHandler() {
        $.table.search();
        $.modal.loading("正在查询数据，请稍候...");
        $.table.onLoadSuccess()
    }

    // 展开隐藏菜单
    var flag = true;

    function openClose() {
        if (flag) {
            $("#openClose").show()
            $("#openCloseSpan").text("隐藏")
            $("#openCloseI").prop("class", "fa fa-upload")
        } else {
            $("#openClose").hide()
            $("#openCloseSpan").text("展示")
            $("#openCloseI").prop("class", "fa fa-download")
        }
        flag = !flag
    }

    // daterangepicker 调用
    $(function () {
        $("#defaultrange").daterangepicker({
            opens: "center", //打开的方向，可选值有‘left‘/‘right‘/‘center‘
            format: "YYYY-MM-DD",
            separator: " to ",
            startDate: moment().subtract(6, "days"),
            endDate: moment(),
            locale: {
                applyLabel: '确定',
                cancelLabel: '取消',
                fromLabel: '起始时间',
                toLabel: '结束时间',
                customRangeLabel: '',
                daysOfWeek: ['日', '一', '二', '三', '四', '五', '六'],
                monthNames: ['一月', '二月', '三月', '四月', '五月', '六月', '七月', '八月', '九月', '十月', '十一月', '十二月'],
                firstDay: 1,

            },
            //dateLimit: { days: 30 }, //起止时间的最大间隔
            minDate: "01/01/2012",
            maxDate: moment()
        }, function (t, e) {
            $("#defaultrange input").val(t.format("YYYY/MM/DD") + " - " + e.format("YYYY/MM/DD"));
            $('#tallyDtStart').val(t.format("YYYY-MM-DD"))
            $('#tallyDtEnd').val(e.format("YYYY-MM-DD"))
        }),
            $("#defaultrange input").val(moment().subtract(6, "days").format("YYYY/MM/DD") + " - " + moment().format("YYYY/MM/DD")); //设置初始值

    });
    // 日期框js
    $(function () {
        // 记账日期限制30天
        layui.use('laydate', function () {
            var laydate = layui.laydate;
            var startDate = laydate.render({
                elem: '#tallyDtStart',
                max: 'nowTime', //今天及以前
                // max: $('#borDays').val(),
                theme: 'molv',
                trigger: 'click',
                done: function (value, date) {//控件选择完毕后的回调---点击日期、清空、现在、确定均会触发。
                    $("#tallyDtEnd").val("")
                    var today = new Date();
                    var toYear = today.getFullYear();
                    var toMonth = today.getMonth();
                    var toDate = today.getDate();
                    var todataStr = toYear + '-' + toMonth + '-' + toDate;
                    var dataStr = date.year + '-' + date.month + '-' + date.date;
                    if (value !== '') {
                        endDate.config.min.year = date.year;
                        endDate.config.min.month = date.month == toMonth ? toMonth : date.month - 1;
                        endDate.config.min.date = date.date == today ? date.date : date.date;
                        endDate.config.max.year = date.year;
                        endDate.config.max.month = date.month;
                        endDate.config.max.date = date.date - 1;
                        if (toYear === date.year) {// 同年
                            // 同月
                            if (date.month === toMonth) {
                                endDate.config.max.month = date.month;
                                if (date.date + 30 > 31) {
                                    endDate.config.max.date = date.date;
                                }
                                endDate.config.max.date = date.date > toDate ? toDate : date.date;
                            }
                            // 上个月
                            if (date.month + 1 === toMonth) {
                                endDate.config.max.date = date.date >= toDate ? toDate : date.date - 1;
                            }
                        }
                        if (todataStr == dataStr) {
                            endDate.config.min.year = date.year;
                            endDate.config.max.year = date.year;
                            endDate.config.min.month = date.month - 1;
                            endDate.config.max.month = date.month - 1;
                            endDate.config.min.date = date.date;
                            endDate.config.max.date = date.date;
                        }

                    }
                }
            });
            var endDate = laydate.render({
                elem: '#tallyDtEnd',
                min: $('#tallyDtStart').val(),
                max: 'nowTime', //今天及以前
                btns: ['clear'],
                theme: 'molv',
                trigger: 'click',
                done: function (value, date) {//控件在打开时触发，回调返回一个参数
                    if ($("#tallyDtStart").val() == "") {
                        $.modal.alert("请先填写利用开始时间")
                        $("#tallyDtEnd").val("")
                    }
                }
            });
            var acctsYear = laydate.render({
                elem: '#acctsYear',
                theme: 'molv',
                trigger: 'click',
                type: 'year',
                max: 0
            });
            // var acctsMonth = laydate.render({
            //     elem: '#acctsMonth',
            //     theme: 'molv',
            //     trigger: 'click',
            //     type : 'month',
            //     max:0,
            //     done: function(value, date) {//控件在打开时触发，回调返回一个参数
            //         $("#acctsMonthHidden").val(date.month)
            //     }
            // });
            var auditDt = laydate.render({
                elem: '#auditDt',
                theme: 'molv',
                trigger: 'click',
                max: 0
            });
            var prepareDt = laydate.render({
                elem: '#prepareDt',
                theme: 'molv',
                trigger: 'click',
                max: 0
            });


        });
    });

    $(function () {
        var options = {
            url: prefix + "/list",
            createUrl: prefix + "/add",
            updateUrl: prefix + "/edit/{id}",
            removeUrl: prefix + "/remove",
            exportUrl: prefix + "/export",
            detailUrl: prefix + "/detail/{id}",
            modalName: "财务",
            showExport: true,
            firstLoad: false,
            columns: [{
                checkbox: true
            },
                {
                    field: 'dealNum',
                    title: '交易流水号',
                    sortable: true,
                    visible: true
                },

                {
                    field: 'dealAcct',
                    title: '交易账户',
                    sortable: true,
                    visible: true
                },
                {
                    field: 'subjId',
                    title: '会计科目',
                    sortable: true,
                    visible: true,
                },
                {
                    field: 'voucherId',
                    title: '凭证号',
                    sortable: true,
                    visible: true
                },
                {
                    field: 'entryId',
                    title: '分录号',
                    sortable: true,
                    visible: true
                },
                {
                    field: 'asstSrcSys',
                    title: '辅助核算项来源系统',
                    sortable: true,
                    visible: true
                },
                {
                    field: 'tallyDt',
                    title: '记账日期',
                    sortable: true,
                    visible: false,
                },
                {
                    field: 'entryCont',
                    title: '分录摘要',
                    sortable: true,
                    visible: false,

                },
                {
                    field: 'pkEntryDtl',
                    title: '主键',
                    visible: false,
                    sortable: true

                },
                {
                    field: 'bookkeeper',
                    title: '记账人',
                    sortable: true,
                    visible: false,

                },

                {
                    field: 'bookId',
                    title: '账簿编号',
                    sortable: true,
                    visible: false
                },
                {
                    field: 'voucherCate',
                    title: '凭证类别',
                    sortable: true,
                    visible: false
                },
                {
                    field: 'auditor',
                    title: '审核人',
                    sortable: true,
                    visible: false
                },
                {
                    field: 'preparer',
                    title: '制单人',
                    sortable: true,
                    visible: false
                },
                {
                    field: 'acctsYear',
                    title: '会计年度',
                    sortable: true,
                    visible: false
                },
                {
                    field: 'acctsMonth',
                    title: '会计月份',
                    sortable: true,
                    visible: false
                },
                {
                    field: 'adjPeriod',
                    title: '调整期间',
                    sortable: true,
                    visible: false
                },
                {
                    field: 'auditDt',
                    title: '审核日期',
                    sortable: true,
                    visible: false
                },
                {
                    field: 'prepareDt',
                    title: '制单日期',
                    sortable: true,
                    visible: false
                },
                {
                    field: 'addBillNum',
                    title: '附属单据',
                    sortable: true,
                    visible: false
                },
                {
                    field: 'prepareSys',
                    title: '制单系统',
                    sortable: true,
                    visible: false
                },
                {
                    field: 'asstOrg',
                    title: '辅助核算项部门',
                    sortable: true,
                    visible: false
                },
                {
                    field: 'ccyId',
                    title: '币种编号',
                    sortable: true,
                    visible: true,
                    formatter: function (value, item, index) {
                        return $.table.selectDictLabel(ccyId, item.ccyId);
                    }
                },
                {
                    field: 'exRate',
                    title: '汇率',
                    sortable: true,
                    visible: false
                },
                {
                    field: 'amtDir',
                    title: '发生额方向',
                    sortable: true,
                    visible: true,
                    formatter: function (value, item, index) {
                        return $.table.selectDictLabel(amtDir, item.amtDir);
                    }
                },
                {
                    field: 'oriDebAmt',
                    title: '原币借方发生额',
                    sortable: true,
                    visible: false
                },
                {
                    field: 'oriCrdAmt',
                    title: '原币贷方发生额',
                    sortable: true,
                    visible: false
                },
                {
                    field: 'locDebAmt',
                    title: '本币借方发生额',
                    sortable: true,
                    visible: false
                },
                {
                    field: 'locCrdAmt',
                    title: '本币贷方发生额',
                    sortable: true,
                    visible: false
                },
                {
                    field: 'isEyearTurn',
                    title: '是否年末结转',
                    sortable: true,
                    visible: false,
                    formatter: function (value, item, index) {
                        return $.table.selectDictLabel(isEyearTurn, item.isEyearTurn);
                    }
                },
                {
                    field: 'isOff',
                    title: '是否表外',
                    sortable: true,
                    visible: false,
                    formatter: function (value, item, index) {
                        return $.table.selectDictLabel(isOff, item.isOff);
                    }
                },
                {
                    field: 'gftEntryDtlId',
                    title: '',
                    sortable: true,
                    visible: false
                },
                {
                    title: '操作',
                    align: 'center',
                    formatter: function (value, row, index) {
                        var actions = [];
                        actions.push('<a class="btn btn-success btn-xs ' + detailFlag + '" href="javascript:void(0)" onclick="openDetail(\'' + row.dealNum + '\')"><i class="fa fa-edit"></i>详情</a> ');
                        // actions.push('<a class="btn btn-danger btn-xs ' + removeFlag + '" href="javascript:void(0)" onclick="$.operate.remove(\'' + row.pkEntryDtl + '\')"><i class="fa fa-remove"></i>删除</a>');
                        return actions.join('');
                    }
                }]
        };
        $.table.init(options);
    });
    $.table.onLoadSuccess = function onLoadSuccess(data) {
        if (typeof $.table._option.onLoadSuccess == "function") {
            $.table._option.onLoadSuccess(data);
            $.modal.closeLoading();
        }
        if (data != undefined) {
            $.modal.closeLoading();
        }
        // 浮动提示框特效
        $("[data-toggle='tooltip']").tooltip();
    }

    function selectUser(id) {
        var options = {
            title: '选择用户',
            /* width: width,
             height: height,*/
            id: id,
            url: ctx + "accounting/ledger/gasSmUser/selectGasSmUser?id=" + id,
            btn: ['确定', '关闭'],
            shadeClose: true,
            yes: function (index, layero) {
                var body = layer.getChildFrame('body', index);
                $('#' + id).val(body.find('#selectedCode').val());
                layer.close(index);
            },
            cancel: function (index) {
                return true;
            }
        };
        $.modal.openOptions(options);
    }

    function selectSubjId(id) {
        var options = {
            title: '选择会计科目',
            /* width: width,
             height: height,*/
            id: id,
            url: ctx + "accounting/ledger/gasBdAccasoa/selectGasBdAccasoa?id=" + id,
            btn: ['确定', '关闭'],
            shadeClose: true,
            yes: function (index, layero) {
                var body = layer.getChildFrame('body', index);
                $('#' + id).val(body.find('#selectedDispname').val());
                layer.close(index);
            },
            cancel: function () {
                return true;
            }
        };
        $.modal.openOptions(options);
    }

    function selectBook(id) {
        var options = {
            title: '选择账簿',
            /* width: width,
             height: height,*/
            id: id,
            url: ctx + "accounting/ledger/gasOrgAccountingbook/selectGasOrgAccountingbook?id=" + id,
            btn: ['确定', '关闭'],
            shadeClose: true,
            yes: function (index, layero) {
                var body = layer.getChildFrame('body', index);
                $('#' + id).val(body.find('#selectedCode').val());
                layer.close(index);
            },
            cancel: function () {
                return true;
            }
        };
        $.modal.openOptions(options);
    }

    function selectOrg(id) {
        var options = {
            title: '选择部门',
            /* width: width,
             height: height,*/
            id: id,
            url: ctx + "accounting/ledger/gasOrgOrgs/selectGasOrgOrgs?id=" + id,
            btn: ['确定', '关闭'],
            shadeClose: true,
            yes: function (index, layero) {
                var body = layer.getChildFrame('body', index);
                $('#' + id).val(body.find('#selectedCode').val());
                layer.close(index);
            },
            cancel: function () {
                return true;
            }
        };
        $.modal.openOptions(options);
    }

    // 详情
    function openDetail(id) {
        var result = $('#form-gftEntryDtl-search').serialize();//.split("&").join(",");
        //result = "id=" + id +","+ result;
        //result = result.replace(/=/g,":");
        //result = JSON.stringify(result.split(","));

        console.log(result)

        var url = prefix + "/detail/" + id + "?" + result;
        $.modal.open("财务详细", url);
    }
</script>
</body>
</html>